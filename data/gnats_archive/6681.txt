Received: (qmail 36452 invoked by uid 501); 15 Oct 2000 06:10:40 -0000
Message-Id: <20001015061040.36451.qmail@locus.apache.org>
Date: 15 Oct 2000 06:10:40 -0000
From: Michael Long <mlong@infoave.net>
Reply-To: mlong@infoave.net
To: submit@bugz.apache.org
Subject: [PATCH 2.0a7] libtool is 2 versions out of date - newest version has support for Tru64 5.x + others
X-Send-Pr-Version: 3.110

>Number:         6681
>Category:       build
>Synopsis:       [PATCH 2.0a7] libtool is 2 versions out of date - newest version has support for Tru64 5.x + others
>Confidential:   no
>Severity:       serious
>Priority:       medium
>Responsible:    apache
>State:          closed
>Quarter:        
>Keywords:       
>Date-Required:
>Class:          change-request
>Submitter-Id:   apache
>Arrival-Date:   Sat Oct 14 23:20:00 PDT 2000
>Closed-Date:    Mon Nov 06 17:22:23 PST 2000
>Last-Modified:  Mon Nov 06 17:22:23 PST 2000
>Originator:     mlong@infoave.net
>Release:        2.0a7
>Organization:
>Environment:
n/a
>Description:
This is a straight patch between libtool 1.3.5 and apache2.0a7/src/ so it should work if the one in apache src was indeed virgin distro 1.3.3. If not, you'd need to put any special modifications back. I haven't tried this as I cannot even compile with the old one :)

Below are two patches..ltconfig.patch and ltmain.patch

*** ltconfig	Sat Mar 11 19:37:28 2000
--- /usr/users/sysadmin/libtool-1.3.5/ltconfig	Sat May 27 07:15:00 2000
***************
*** 53,59 ****
  
  # Find the correct PATH separator.  Usually this is `:', but
  # DJGPP uses `;' like DOS.
! if test "X${PATH_SEPARATOR+set}" != "Xset"; then
    UNAME=${UNAME-`uname 2>/dev/null`}
    case X$UNAME in
      *-DOS) PATH_SEPARATOR=';' ;;
--- 53,59 ----
  
  # Find the correct PATH separator.  Usually this is `:', but
  # DJGPP uses `;' like DOS.
! if test "X${PATH_SEPARATOR+set}" != Xset; then
    UNAME=${UNAME-`uname 2>/dev/null`}
    case X$UNAME in
      *-DOS) PATH_SEPARATOR=';' ;;
***************
*** 63,71 ****
  
  # The HP-UX ksh and POSIX shell print the target directory to stdout
  # if CDPATH is set.
! if test "${CDPATH+set}" = set; then CDPATH=; export CDPATH; fi
  
! if test "X${echo_test_string+set}" != "Xset"; then
    # find a string as large as possible, as long as the shell can cope with it
    for cmd in 'sed 50q "$0"' 'sed 20q "$0"' 'sed 10q "$0"' 'sed 2q "$0"' 'echo test'; do
      # expected sizes: less than 2Kb, 1Kb, 512 bytes, 16 bytes, ...
--- 63,71 ----
  
  # The HP-UX ksh and POSIX shell print the target directory to stdout
  # if CDPATH is set.
! if test "X${CDPATH+set}" = Xset; then CDPATH=:; export CDPATH; fi
  
! if test "X${echo_test_string+set}" != Xset; then
    # find a string as large as possible, as long as the shell can cope with it
    for cmd in 'sed 50q "$0"' 'sed 20q "$0"' 'sed 10q "$0"' 'sed 2q "$0"' 'echo test'; do
      # expected sizes: less than 2Kb, 1Kb, 512 bytes, 16 bytes, ...
***************
*** 169,178 ****
  # Constants:
  PROGRAM=ltconfig
  PACKAGE=libtool
! VERSION=1.3.3-freebsd-ports
! TIMESTAMP=" (1.385.2.181 1999/07/02 15:49:11)"
! ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.c 1>&5'
! ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.c $LIBS 1>&5'
  rm="rm -f"
  
  help="Try \`$progname --help' for more information."
--- 169,178 ----
  # Constants:
  PROGRAM=ltconfig
  PACKAGE=libtool
! VERSION=1.3.5
! TIMESTAMP=" (1.385.2.206 2000/05/27 11:12:27)"
! ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
! ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
  rm="rm -f"
  
  help="Try \`$progname --help' for more information."
***************
*** 185,192 ****
  # which needs '.lib').
  enable_static=yes
  enable_fast_install=yes
- install_ltlibs=yes
- release_suffix=yes
  enable_dlopen=unknown
  enable_win32_dll=no
  ltmain=
--- 185,190 ----
***************
*** 248,256 ****
      --disable-shared       do not build shared libraries
      --disable-static       do not build static libraries
      --disable-fast-install do not optimize for fast installation
-     --disable-ltlibs       don't install the .la archives
-     --release-ignore       don't use -release specification
-     --release-suffix       use -release suffix for all files
      --enable-dlopen        enable dlopen support
      --enable-win32-dll     enable building dlls on win32 hosts
      --help                 display this help and exit
--- 246,251 ----
***************
*** 284,295 ****
  
    --disable-fast-install) enable_fast_install=no ;;
  
-   --disable-ltlibs) install_ltlibs=no ;;
- 
-   --release-ignore) release_suffix=no ;;
- 
-   --release-suffix) release_suffix=all ;;
- 
    --enable-dlopen) enable_dlopen=yes ;;
  
    --enable-win32-dll) enable_win32_dll=yes ;;
--- 279,284 ----
***************
*** 380,387 ****
  # Only set LANG and LC_ALL to C if already set.
  # These must not be set unconditionally because not all systems understand
  # e.g. LANG=C (notably SCO).
! if test "${LC_ALL+set}" = set; then LC_ALL=C; export LC_ALL; fi
! if test "${LANG+set}"   = set; then LANG=C;   export LANG;   fi
  
  if test -n "$cache_file" && test -r "$cache_file"; then
    echo "loading cache $cache_file within ltconfig"
--- 369,376 ----
  # Only set LANG and LC_ALL to C if already set.
  # These must not be set unconditionally because not all systems understand
  # e.g. LANG=C (notably SCO).
! if test "X${LC_ALL+set}" = Xset; then LC_ALL=C; export LC_ALL; fi
! if test "X${LANG+set}"   = Xset; then LANG=C;   export LANG;   fi
  
  if test -n "$cache_file" && test -r "$cache_file"; then
    echo "loading cache $cache_file within ltconfig"
***************
*** 473,479 ****
    # AIX sometimes has problems with the GCC collect2 program.  For some
    # reason, if we set the COLLECT_NAMES environment variable, the problems
    # vanish in a puff of smoke.
!   if test "${COLLECT_NAMES+set}" != set; then
      COLLECT_NAMES=
      export COLLECT_NAMES
    fi
--- 462,468 ----
    # AIX sometimes has problems with the GCC collect2 program.  For some
    # reason, if we set the COLLECT_NAMES environment variable, the problems
    # vanish in a puff of smoke.
!   if test "X${COLLECT_NAMES+set}" != Xset; then
      COLLECT_NAMES=
      export COLLECT_NAMES
    fi
***************
*** 674,680 ****
    link_static_flag='-static'
  
    case "$host_os" in
!   beos* | irix5* | irix6* | osf3* | osf4*)
      # PIC is the default for these OSes.
      ;;
    aix*)
--- 663,669 ----
    link_static_flag='-static'
  
    case "$host_os" in
!   beos* | irix5* | irix6* | osf3* | osf4* | osf5*)
      # PIC is the default for these OSes.
      ;;
    aix*)
***************
*** 729,735 ****
      # We can build DLLs from non-PIC.
      ;;
  
!   osf3* | osf4*)
      # All OSF/1 code is PIC.
      wl='-Wl,'
      link_static_flag='-non_shared'
--- 718,724 ----
      # We can build DLLs from non-PIC.
      ;;
  
!   osf3* | osf4* | osf5*)
      # All OSF/1 code is PIC.
      wl='-Wl,'
      link_static_flag='-non_shared'
***************
*** 982,992 ****
    $rm conftest.dat
    if ln -s X conftest.dat 2>/dev/null; then
      $rm conftest.dat
!     LN_S="ln -sf"
    else
      LN_S=ln
    fi
!   if test "$LN_S" = "ln -sf"; then
      echo "$ac_t"yes 1>&6
    else
      echo "$ac_t"no 1>&6
--- 971,981 ----
    $rm conftest.dat
    if ln -s X conftest.dat 2>/dev/null; then
      $rm conftest.dat
!     LN_S="ln -s"
    else
      LN_S=ln
    fi
!   if test "$LN_S" = "ln -s"; then
      echo "$ac_t"yes 1>&6
    else
      echo "$ac_t"no 1>&6
***************
*** 1175,1189 ****
      # Extract the symbol export list from an `--export-all' def file,
      # then regenerate the def file from the symbol export list, so that
      # the compiled dll only exports the symbol export list.
      export_symbols_cmds='test -f $objdir/$soname-ltdll.c || sed -e "/^# \/\* ltdll\.c starts here \*\//,/^# \/\* ltdll.c ends here \*\// { s/^# //; p; }" -e d < $0 > $objdir/$soname-ltdll.c~
        test -f $objdir/$soname-ltdll.$objext || (cd $objdir && $CC -c $soname-ltdll.c)~
        $DLLTOOL --export-all --exclude-symbols DllMain@12,_cygwin_dll_entry@12,_cygwin_noncygwin_dll_entry@12 --output-def $objdir/$soname-def  $objdir/$soname-ltdll.$objext $libobjs $convenience~
!       sed -e "1,/EXPORTS/d" -e "s/ @ [0-9]* ; *//" < $objdir/$soname-def > $export_symbols'
  
      archive_expsym_cmds='echo EXPORTS > $objdir/$soname-def~
        _lt_hint=1;
!       for symbol in `cat $export_symbols`; do
! 	echo "	\$symbol @ \$_lt_hint ; " >> $objdir/$soname-def;
  	_lt_hint=`expr 1 + \$_lt_hint`;
        done~
        test -f $objdir/$soname-ltdll.c || sed -e "/^# \/\* ltdll\.c starts here \*\//,/^# \/\* ltdll.c ends here \*\// { s/^# //; p; }" -e d < $0 > $objdir/$soname-ltdll.c~
--- 1164,1184 ----
      # Extract the symbol export list from an `--export-all' def file,
      # then regenerate the def file from the symbol export list, so that
      # the compiled dll only exports the symbol export list.
+     # Be careful not to strip the DATA tag left by newer dlltools.
      export_symbols_cmds='test -f $objdir/$soname-ltdll.c || sed -e "/^# \/\* ltdll\.c starts here \*\//,/^# \/\* ltdll.c ends here \*\// { s/^# //; p; }" -e d < $0 > $objdir/$soname-ltdll.c~
        test -f $objdir/$soname-ltdll.$objext || (cd $objdir && $CC -c $soname-ltdll.c)~
        $DLLTOOL --export-all --exclude-symbols DllMain@12,_cygwin_dll_entry@12,_cygwin_noncygwin_dll_entry@12 --output-def $objdir/$soname-def  $objdir/$soname-ltdll.$objext $libobjs $convenience~
!       sed -e "1,/EXPORTS/d" -e "s/ @ [0-9]*//" -e "s/ *;.*$//" < $objdir/$soname-def > $export_symbols'
  
+     # If DATA tags from a recent dlltool are present, honour them!
      archive_expsym_cmds='echo EXPORTS > $objdir/$soname-def~
        _lt_hint=1;
!       cat $export_symbols | while read symbol; do
!         set dummy \$symbol;
!         case \$# in
!           2) echo "	\$2 @ \$_lt_hint ; " >> $objdir/$soname-def;;
!           *) echo "     \$2 @ \$_lt_hint \$3 ; " >> $objdir/$soname-def;;
!         esac;
  	_lt_hint=`expr 1 + \$_lt_hint`;
        done~
        test -f $objdir/$soname-ltdll.c || sed -e "/^# \/\* ltdll\.c starts here \*\//,/^# \/\* ltdll.c ends here \*\// { s/^# //; p; }" -e d < $0 > $objdir/$soname-ltdll.c~
***************
*** 1198,1204 ****
      ;;
  
    netbsd*)
!     if $LD --help 2>&1 | egrep ': supported targets:.* elf' > /dev/null; then
        archive_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname -o $lib'
        archive_expsym_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
      else
--- 1193,1199 ----
      ;;
  
    netbsd*)
!     if echo __ELF__ | $CC -E - | grep __ELF__ >/dev/null; then
        archive_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname -o $lib'
        archive_expsym_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
      else
***************
*** 1207,1213 ****
      fi
      ;;
  
!   solaris*)
      if $LD -v 2>&1 | egrep 'BFD 2\.8' > /dev/null; then
        ld_shlibs=no
        cat <<EOF 1>&2
--- 1202,1208 ----
      fi
      ;;
  
!   solaris* | sysv5*)
      if $LD -v 2>&1 | egrep 'BFD 2\.8' > /dev/null; then
        ld_shlibs=no
        cat <<EOF 1>&2
***************
*** 1237,1244 ****
  
    *)
      if $LD --help 2>&1 | egrep ': supported targets:.* elf' > /dev/null; then
!       archive_cmds='$CC -shared $compile_rpath $libobjs $deplibs $linkopts ${wl}-soname $wl$soname -o $lib'
!       archive_expsym_cmds='$CC -shared $compile_rpath $libobjs $deplibs $linkopts ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
      else
        ld_shlibs=no
      fi
--- 1232,1239 ----
  
    *)
      if $LD --help 2>&1 | egrep ': supported targets:.* elf' > /dev/null; then
!       archive_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname -o $lib'
!       archive_expsym_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
      else
        ld_shlibs=no
      fi
***************
*** 1255,1261 ****
        whole_archive_flag_spec=
        ;;
      *)
!       whole_archive_flag_spec="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
        ;;
      esac
    fi
--- 1250,1261 ----
        whole_archive_flag_spec=
        ;;
      *)
!       # ancient GNU ld didn't support --whole-archive et. al.
!       if $LD --help 2>&1 | egrep 'no-whole-archive' > /dev/null; then
!         whole_archive_flag_spec="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
!       else
!         whole_archive_flag_spec=
!       fi
        ;;
      esac
    fi
***************
*** 1359,1364 ****
--- 1359,1372 ----
      hardcode_shlibpath_var=no
      ;;
  
+   # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
+   freebsd*)
+     archive_cmds='$CC -shared -o $lib $libobjs $deplibs $linkopts'
+     hardcode_libdir_flag_spec='-R$libdir'
+     hardcode_direct=yes
+     hardcode_shlibpath_var=no
+     ;;
+ 
    hpux9* | hpux10* | hpux11*)
      case "$host_os" in
      hpux9*) archive_cmds='$rm $objdir/$soname~$LD -b +b $install_libdir -o $objdir/$soname $libobjs $deplibs $linkopts~test $objdir/$soname = $lib || mv $objdir/$soname $lib' ;;
***************
*** 1408,1414 ****
      old_archive_from_new_cmds='emximp -o $objdir/$libname.a $objdir/$libname.def'
      ;;
  
!   osf3* | osf4*)
      if test "$with_gcc" = yes; then
        allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
        archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $linkopts ${wl}-soname ${wl}$soname `test -n "$verstring" && echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
--- 1416,1422 ----
      old_archive_from_new_cmds='emximp -o $objdir/$libname.a $objdir/$libname.def'
      ;;
  
!   osf3*)
      if test "$with_gcc" = yes; then
        allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
        archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $linkopts ${wl}-soname ${wl}$soname `test -n "$verstring" && echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
***************
*** 1420,1425 ****
--- 1428,1451 ----
      hardcode_libdir_separator=:
      ;;
  
+   osf4* | osf5*)  # As osf3* with the addition of the -msym flag
+     if test "$with_gcc" = yes; then
+       allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
+       archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $linkopts ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
+     else
+       allow_undefined_flag=' -expect_unresolved \*'
+       archive_cmds='$LD -shared${allow_undefined_flag} $libobjs $deplibs $linkopts -msym -soname $soname `test -n "$verstring" && echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
+     fi
+     hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+     hardcode_libdir_separator=:
+     ;;
+   rhapsody*)
+     archive_cmds='$CC -bundle -undefined suppress -o $lib $libobjs $deplibs $linkopts'
+     hardcode_libdir_flags_spec='-L$libdir'
+     hardcode_direct=yes
+     hardcode_shlibpath_var=no
+     ;;
+                                        
    sco3.2v5*)
      archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linkopts'
      hardcode_shlibpath_var=no
***************
*** 1452,1458 ****
      ;;
  
    sysv4)
!     archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linkopts'
      runpath_var='LD_RUN_PATH'
      hardcode_shlibpath_var=no
      hardcode_direct=no #Motorola manual says yes, but my tests say they lie 
--- 1478,1490 ----
      ;;
  
    sysv4)
!     if test "x$host_vendor" = xsequent; then
!       # Use $CC to link under sequent, because it throws in some extra .o 
!       # files that make .init and .fini sections work.
!       archive_cmds='$CC -G ${wl}-h $soname -o $lib $libobjs $deplibs $linkopts'
!     else
!       archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linkopts'
!     fi
      runpath_var='LD_RUN_PATH'
      hardcode_shlibpath_var=no
      hardcode_direct=no #Motorola manual says yes, but my tests say they lie 
***************
*** 1464,1469 ****
--- 1496,1513 ----
      export_dynamic_flag_spec='-Bexport'
      ;;
  
+   sysv5*)
+     no_undefined_flag=' -z text'
+     # $CC -shared without GNU ld will not create a library from C++
+     # object files and a static libstdc++, better avoid it by now
+     archive_cmds='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linkopts'
+     archive_expsym_cmds='$echo "{ global:" > $lib.exp~cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
+ 		$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linkopts~$rm $lib.exp'
+     hardcode_libdir_flag_spec=
+     hardcode_shlibpath_var=no
+     runpath_var='LD_RUN_PATH'
+     ;;
+ 
    uts4*)
      archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linkopts'
      hardcode_libdir_flag_spec='-L$libdir'
***************
*** 1477,1492 ****
      ;;
  
    sysv4*MP*)
!     if test -d /usr/nec ;then
!     # archive_cmds='$LD -G -z text -h $soname -o $lib$libobjs$deplibs'
!     archive_cmds='$LD -G -h $soname -o $lib$libobjs$deplibs'
      hardcode_shlibpath_var=no
-     runpath_var=LD_RUN_PATH
      hardcode_runpath_var=yes
!     ld_shlibs=yes
!     fi
      ;;
  
    *)
      ld_shlibs=no
      ;;
--- 1521,1550 ----
      ;;
  
    sysv4*MP*)
!     if test -d /usr/nec; then
!       archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linkopts'
!       hardcode_shlibpath_var=no
!       runpath_var=LD_RUN_PATH
!       hardcode_runpath_var=yes
!       ld_shlibs=yes
!     fi
!     ;;
! 
!   sysv4.2uw2*)
!     archive_cmds='$LD -G -o $lib $libobjs $deplibs $linkopts'
!     hardcode_direct=yes
!     hardcode_minus_L=no
      hardcode_shlibpath_var=no
      hardcode_runpath_var=yes
!     runpath_var=LD_RUN_PATH
      ;;
  
+   unixware7*)
+     archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linkopts'
+     runpath_var='LD_RUN_PATH'
+     hardcode_shlibpath_var=no
+     ;;
+ 
    *)
      ld_shlibs=no
      ;;
***************
*** 1592,1602 ****
  main(){nm_test_var='a';nm_test_func();return(0);}
  EOF
  
!   echo "$progname:1592: checking if global_symbol_pipe works" >&5
!   if { (eval echo $progname:1593: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; } && test -s conftest.$objext; then
      # Now try to grab the symbols.
      nlist=conftest.nm
!     if { echo "$progname:1596: eval \"$NM conftest.$objext | $global_symbol_pipe > $nlist\"" >&5; eval "$NM conftest.$objext | $global_symbol_pipe > $nlist 2>&5"; } && test -s "$nlist"; then
  
        # Try sorting and uniquifying the output.
        if sort "$nlist" | uniq > "$nlist"T; then
--- 1650,1660 ----
  main(){nm_test_var='a';nm_test_func();return(0);}
  EOF
  
!   echo "$progname:1653: checking if global_symbol_pipe works" >&5
!   if { (eval echo $progname:1654: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; } && test -s conftest.$objext; then
      # Now try to grab the symbols.
      nlist=conftest.nm
!     if { echo "$progname:1657: eval \"$NM conftest.$objext | $global_symbol_pipe > $nlist\"" >&5; eval "$NM conftest.$objext | $global_symbol_pipe > $nlist 2>&5"; } && test -s "$nlist"; then
  
        # Try sorting and uniquifying the output.
        if sort "$nlist" | uniq > "$nlist"T; then
***************
*** 1648,1654 ****
  	  save_CFLAGS="$CFLAGS"
  	  LIBS="conftstm.$objext"
  	  CFLAGS="$CFLAGS$no_builtin_flag"
! 	  if { (eval echo $progname:1648: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
  	    pipe_works=yes
  	  else
  	    echo "$progname: failed program was:" >&5
--- 1706,1712 ----
  	  save_CFLAGS="$CFLAGS"
  	  LIBS="conftstm.$objext"
  	  CFLAGS="$CFLAGS$no_builtin_flag"
! 	  if { (eval echo $progname:1709: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
  	    pipe_works=yes
  	  else
  	    echo "$progname: failed program was:" >&5
***************
*** 1735,1741 ****
  version_type=none
  dynamic_linker="$host_os ld.so"
  sys_lib_dlsearch_path_spec="/lib /usr/lib"
! sys_lib_search_path_spec="/lib /usr/lib"
  file_magic_cmd=
  file_magic_test_file=
  deplibs_check_method='unknown'
--- 1793,1799 ----
  version_type=none
  dynamic_linker="$host_os ld.so"
  sys_lib_dlsearch_path_spec="/lib /usr/lib"
! sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
  file_magic_cmd=
  file_magic_test_file=
  deplibs_check_method='unknown'
***************
*** 1790,1797 ****
  
  bsdi4*)
    version_type=linux
!   library_names_spec='${libname}.so$major ${libname}.so'
!   soname_spec='${libname}.so'
    finish_cmds='PATH="\$PATH:/sbin" ldconfig $libdir'
    shlibpath_var=LD_LIBRARY_PATH
    deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib)'
--- 1848,1856 ----
  
  bsdi4*)
    version_type=linux
!   need_version=no
!   library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
!   soname_spec='${libname}${release}.so$major'
    finish_cmds='PATH="\$PATH:/sbin" ldconfig $libdir'
    shlibpath_var=LD_LIBRARY_PATH
    deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib)'
***************
*** 1799,1804 ****
--- 1858,1864 ----
    file_magic_test_file=/shlib/libc.so
    sys_lib_search_path_spec="/shlib /usr/lib /usr/X11/lib /usr/contrib/lib /lib /usr/local/lib"
    sys_lib_dlsearch_path_spec="/shlib /usr/lib /usr/local/lib"
+   export_dynamic_flag_spec=-rdynamic
    # the default ld.so.conf also contains /usr/contrib/lib and
    # /usr/X11R6/lib (/usr/X11 is a link to /usr/X11R6), but let us allow
    # libtool to hard-code these into programs
***************
*** 1832,1855 ****
    case "$version_type" in
      freebsd-elf*)
        deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object'
        ;;
      freebsd-*)
!       deplibs_check_method='file_magic FreeBSD.* shared library'
        ;;
    esac
-   file_magic_cmd=/usr/bin/file
-   file_magic_test_file=`echo /usr/lib/libc.so.*`
-   if test "$release_suffix" = all; then
-     library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so'
-   else
-     library_names_spec='${libname}${release}.so$versuffix ${libname}.so'
-   fi 
-   need_version=no
-   need_lib_prefix=no
-   finish_cmds='/usr/bin/env OBJFORMAT="'"$objformat"'" /sbin/ldconfig -m $libdir'
    shlibpath_var=LD_LIBRARY_PATH
    case "$host_os" in
!   freebsd2* | freebsd3.[01]*)
      shlibpath_overrides_runpath=yes
      ;;
    *) # from 3.2 on
--- 1892,1912 ----
    case "$version_type" in
      freebsd-elf*)
        deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object'
+       file_magic_cmd=/usr/bin/file
+       file_magic_test_file=`echo /usr/lib/libc.so*`
+       library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so $libname.so'
+       need_version=no
+       need_lib_prefix=no
        ;;
      freebsd-*)
!       deplibs_check_method=unknown
!       library_names_spec='${libname}${release}.so$versuffix $libname.so$versuffix'
!       need_version=yes
        ;;
    esac
    shlibpath_var=LD_LIBRARY_PATH
    case "$host_os" in
!   freebsd2* | freebsd3.[01]* | freebsdelf3.[01]*)
      shlibpath_overrides_runpath=yes
      ;;
    *) # from 3.2 on
***************
*** 1880,1885 ****
--- 1937,1950 ----
    soname_spec='${libname}${release}.sl$major'
    # HP-UX runs *really* slowly unless shared libraries are mode 555.
    postinstall_cmds='chmod 555 $lib'
+   case "$host_os" in
+   hpux10.20*)
+     # TODO:  Does this work for hpux-11 too?
+     deplibs_check_method='file_magic (s[0-9][0-9][0-9]|PA-RISC[0-9].[0-9]) shared library'
+     file_magic_cmd=/usr/bin/file
+     file_magic_test_file=/usr/lib/libc.sl
+     ;;
+   esac
    ;;
  
  irix5* | irix6*)
***************
*** 1901,1908 ****
      *-64|*"-64 ") libsuff=64 shlibsuff=64 libmagic=64-bit;;
      *) libsuff= shlibsuff= libmagic=never-match;;
      esac
-     # this will be overridden with pass_all, but let us keep it just in case
-     deplibs_check_method="file_magic ELF ${libmagic} MSB mips-[1234] dynamic lib MIPS - version 1"
      ;;
    esac
    shlibpath_var=LD_LIBRARY${shlibsuff}_PATH
--- 1966,1971 ----
***************
*** 1929,1937 ****
    finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
    shlibpath_var=LD_LIBRARY_PATH
    shlibpath_overrides_runpath=no
!   deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB (shared object|dynamic lib )'
!   file_magic_cmd=/usr/bin/file
!   file_magic_test_file=`echo /lib/libc.so* /lib/libc-*.so`
  
    if test -f /lib/ld.so.1; then
      dynamic_linker='GNU ld.so'
--- 1992,1998 ----
    finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
    shlibpath_var=LD_LIBRARY_PATH
    shlibpath_overrides_runpath=no
!   deplibs_check_method=pass_all
  
    if test -f /lib/ld.so.1; then
      dynamic_linker='GNU ld.so'
***************
*** 1977,1983 ****
    shlibpath_var=LIBPATH
    ;;
  
! osf3* | osf4*)
    version_type=osf
    need_version=no
    soname_spec='${libname}${release}.so'
--- 2038,2044 ----
    shlibpath_var=LIBPATH
    ;;
  
! osf3* | osf4* | osf5*)
    version_type=osf
    need_version=no
    soname_spec='${libname}${release}.so'
***************
*** 1992,1997 ****
--- 2053,2066 ----
    sys_lib_dlsearch_path_spec="$sys_lib_search_path_spec"
    ;;
  
+ rhapsody*)
+   version_type=sunos
+   library_names_spec='${libname}.so'
+   soname_spec='${libname}.so'
+   shlibpath_var=DYLD_LIBRARY_PATH
+   deplibs_check_method=pass_all
+   ;;
+ 
  sco3.2v5*)
    version_type=osf
    soname_spec='${libname}${release}.so$major'
***************
*** 2032,2037 ****
--- 2101,2110 ----
    soname_spec='${libname}${release}.so$major'
    shlibpath_var=LD_LIBRARY_PATH
    case "$host_vendor" in
+     sequent)
+       file_magic_cmd='/bin/file'
+       deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB (shared object|dynamic lib )'
+       ;;
      ncr)
        deplibs_check_method='pass_all'
        ;;
***************
*** 2172,2178 ****
  if eval "test \"`echo '$''{'lt_cv_dlopen'+set}'`\" != set"; then
    lt_cv_dlopen=no lt_cv_dlopen_libs=
  echo $ac_n "checking for dlopen in -ldl""... $ac_c" 1>&6
! echo "$progname:2170: checking for dlopen in -ldl" >&5
  ac_lib_var=`echo dl'_'dlopen | sed 'y%./+-%__p_%'`
  if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
--- 2245,2251 ----
  if eval "test \"`echo '$''{'lt_cv_dlopen'+set}'`\" != set"; then
    lt_cv_dlopen=no lt_cv_dlopen_libs=
  echo $ac_n "checking for dlopen in -ldl""... $ac_c" 1>&6
! echo "$progname:2248: checking for dlopen in -ldl" >&5
  ac_lib_var=`echo dl'_'dlopen | sed 'y%./+-%__p_%'`
  if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
***************
*** 2180,2189 ****
    ac_save_LIBS="$LIBS"
  LIBS="-ldl  $LIBS"
  cat > conftest.$ac_ext <<EOF
! #line 2178 "ltconfig"
  /* Override any gcc2 internal prototype to avoid an error.  */
  /* We use char because int might match the return type of a gcc2
      builtin and then its argument prototype would still apply.  */
  char dlopen();
  
  int main() {
--- 2253,2265 ----
    ac_save_LIBS="$LIBS"
  LIBS="-ldl  $LIBS"
  cat > conftest.$ac_ext <<EOF
! #line 2256 "ltconfig"
  /* Override any gcc2 internal prototype to avoid an error.  */
  /* We use char because int might match the return type of a gcc2
      builtin and then its argument prototype would still apply.  */
+ #ifdef __cplusplus
+ extern "C"
+ #endif
  char dlopen();
  
  int main() {
***************
*** 2190,2196 ****
  dlopen()
  ; return 0; }
  EOF
! if { (eval echo $progname:2188: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
    rm -rf conftest*
    eval "ac_cv_lib_$ac_lib_var=yes"
  else
--- 2266,2272 ----
  dlopen()
  ; return 0; }
  EOF
! if { (eval echo $progname:2269: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
    rm -rf conftest*
    eval "ac_cv_lib_$ac_lib_var=yes"
  else
***************
*** 2209,2220 ****
  else
    echo "$ac_t""no" 1>&6
  echo $ac_n "checking for dlopen""... $ac_c" 1>&6
! echo "$progname:2207: checking for dlopen" >&5
  if eval "test \"`echo '$''{'ac_cv_func_dlopen'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
  else
    cat > conftest.$ac_ext <<EOF
! #line 2212 "ltconfig"
  /* System header to define __stub macros and hopefully few prototypes,
      which can conflict with char dlopen(); below.  */
  #include <assert.h>
--- 2285,2296 ----
  else
    echo "$ac_t""no" 1>&6
  echo $ac_n "checking for dlopen""... $ac_c" 1>&6
! echo "$progname:2288: checking for dlopen" >&5
  if eval "test \"`echo '$''{'ac_cv_func_dlopen'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
  else
    cat > conftest.$ac_ext <<EOF
! #line 2293 "ltconfig"
  /* System header to define __stub macros and hopefully few prototypes,
      which can conflict with char dlopen(); below.  */
  #include <assert.h>
***************
*** 2221,2226 ****
--- 2297,2305 ----
  /* Override any gcc2 internal prototype to avoid an error.  */
  /* We use char because int might match the return type of a gcc2
      builtin and then its argument prototype would still apply.  */
+ #ifdef __cplusplus
+ extern "C"
+ #endif
  char dlopen();
  
  int main() {
***************
*** 2236,2242 ****
  
  ; return 0; }
  EOF
! if { (eval echo $progname:2234: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
    rm -rf conftest*
    eval "ac_cv_func_dlopen=yes"
  else
--- 2315,2321 ----
  
  ; return 0; }
  EOF
! if { (eval echo $progname:2318: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
    rm -rf conftest*
    eval "ac_cv_func_dlopen=yes"
  else
***************
*** 2253,2259 ****
  else
    echo "$ac_t""no" 1>&6
  echo $ac_n "checking for dld_link in -ldld""... $ac_c" 1>&6
! echo "$progname:2251: checking for dld_link in -ldld" >&5
  ac_lib_var=`echo dld'_'dld_link | sed 'y%./+-%__p_%'`
  if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
--- 2332,2338 ----
  else
    echo "$ac_t""no" 1>&6
  echo $ac_n "checking for dld_link in -ldld""... $ac_c" 1>&6
! echo "$progname:2335: checking for dld_link in -ldld" >&5
  ac_lib_var=`echo dld'_'dld_link | sed 'y%./+-%__p_%'`
  if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
***************
*** 2261,2270 ****
    ac_save_LIBS="$LIBS"
  LIBS="-ldld  $LIBS"
  cat > conftest.$ac_ext <<EOF
! #line 2259 "ltconfig"
  /* Override any gcc2 internal prototype to avoid an error.  */
  /* We use char because int might match the return type of a gcc2
      builtin and then its argument prototype would still apply.  */
  char dld_link();
  
  int main() {
--- 2340,2352 ----
    ac_save_LIBS="$LIBS"
  LIBS="-ldld  $LIBS"
  cat > conftest.$ac_ext <<EOF
! #line 2343 "ltconfig"
  /* Override any gcc2 internal prototype to avoid an error.  */
  /* We use char because int might match the return type of a gcc2
      builtin and then its argument prototype would still apply.  */
+ #ifdef __cplusplus
+ extern "C"
+ #endif
  char dld_link();
  
  int main() {
***************
*** 2271,2277 ****
  dld_link()
  ; return 0; }
  EOF
! if { (eval echo $progname:2269: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
    rm -rf conftest*
    eval "ac_cv_lib_$ac_lib_var=yes"
  else
--- 2353,2359 ----
  dld_link()
  ; return 0; }
  EOF
! if { (eval echo $progname:2356: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
    rm -rf conftest*
    eval "ac_cv_lib_$ac_lib_var=yes"
  else
***************
*** 2290,2301 ****
  else
    echo "$ac_t""no" 1>&6
  echo $ac_n "checking for shl_load""... $ac_c" 1>&6
! echo "$progname:2288: checking for shl_load" >&5
  if eval "test \"`echo '$''{'ac_cv_func_shl_load'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
  else
    cat > conftest.$ac_ext <<EOF
! #line 2293 "ltconfig"
  /* System header to define __stub macros and hopefully few prototypes,
      which can conflict with char shl_load(); below.  */
  #include <assert.h>
--- 2372,2383 ----
  else
    echo "$ac_t""no" 1>&6
  echo $ac_n "checking for shl_load""... $ac_c" 1>&6
! echo "$progname:2375: checking for shl_load" >&5
  if eval "test \"`echo '$''{'ac_cv_func_shl_load'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
  else
    cat > conftest.$ac_ext <<EOF
! #line 2380 "ltconfig"
  /* System header to define __stub macros and hopefully few prototypes,
      which can conflict with char shl_load(); below.  */
  #include <assert.h>
***************
*** 2302,2307 ****
--- 2384,2392 ----
  /* Override any gcc2 internal prototype to avoid an error.  */
  /* We use char because int might match the return type of a gcc2
      builtin and then its argument prototype would still apply.  */
+ #ifdef __cplusplus
+ extern "C"
+ #endif
  char shl_load();
  
  int main() {
***************
*** 2317,2323 ****
  
  ; return 0; }
  EOF
! if { (eval echo $progname:2315: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
    rm -rf conftest*
    eval "ac_cv_func_shl_load=yes"
  else
--- 2402,2408 ----
  
  ; return 0; }
  EOF
! if { (eval echo $progname:2405: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
    rm -rf conftest*
    eval "ac_cv_func_shl_load=yes"
  else
***************
*** 2335,2341 ****
  else
    echo "$ac_t""no" 1>&6
  echo $ac_n "checking for shl_load in -ldld""... $ac_c" 1>&6
! echo "$progname:2333: checking for shl_load in -ldld" >&5
  ac_lib_var=`echo dld'_'shl_load | sed 'y%./+-%__p_%'`
  if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
--- 2420,2426 ----
  else
    echo "$ac_t""no" 1>&6
  echo $ac_n "checking for shl_load in -ldld""... $ac_c" 1>&6
! echo "$progname:2423: checking for shl_load in -ldld" >&5
  ac_lib_var=`echo dld'_'shl_load | sed 'y%./+-%__p_%'`
  if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
***************
*** 2343,2353 ****
    ac_save_LIBS="$LIBS"
  LIBS="-ldld  $LIBS"
  cat > conftest.$ac_ext <<EOF
! #line 2341 "ltconfig"
  #include "confdefs.h"
  /* Override any gcc2 internal prototype to avoid an error.  */
  /* We use char because int might match the return type of a gcc2
      builtin and then its argument prototype would still apply.  */
  char shl_load();
  
  int main() {
--- 2428,2441 ----
    ac_save_LIBS="$LIBS"
  LIBS="-ldld  $LIBS"
  cat > conftest.$ac_ext <<EOF
! #line 2431 "ltconfig"
  #include "confdefs.h"
  /* Override any gcc2 internal prototype to avoid an error.  */
  /* We use char because int might match the return type of a gcc2
      builtin and then its argument prototype would still apply.  */
+ #ifdef __cplusplus
+ extern "C"
+ #endif
  char shl_load();
  
  int main() {
***************
*** 2354,2360 ****
  shl_load()
  ; return 0; }
  EOF
! if { (eval echo $progname:2352: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
    rm -rf conftest*
    eval "ac_cv_lib_$ac_lib_var=yes"
  else
--- 2442,2448 ----
  shl_load()
  ; return 0; }
  EOF
! if { (eval echo $progname:2445: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
    rm -rf conftest*
    eval "ac_cv_lib_$ac_lib_var=yes"
  else
***************
*** 2397,2413 ****
  for ac_hdr in dlfcn.h; do
  ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
  echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
! echo "$progname:2395: checking for $ac_hdr" >&5
  if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
  else
    cat > conftest.$ac_ext <<EOF
! #line 2400 "ltconfig"
  #include <$ac_hdr>
  int fnord = 0;
  EOF
! ac_try="$ac_compile conftest.$ac_ext >/dev/null 2>conftest.out"
! { (eval echo $progname:2405: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
  ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
  if test -z "$ac_err"; then
    rm -rf conftest*
--- 2485,2501 ----
  for ac_hdr in dlfcn.h; do
  ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
  echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
! echo "$progname:2488: checking for $ac_hdr" >&5
  if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
    echo $ac_n "(cached) $ac_c" 1>&6
  else
    cat > conftest.$ac_ext <<EOF
! #line 2493 "ltconfig"
  #include <$ac_hdr>
  int fnord = 0;
  EOF
! ac_try="$ac_compile >/dev/null 2>conftest.out"
! { (eval echo $progname:2498: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
  ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
  if test -z "$ac_err"; then
    rm -rf conftest*
***************
*** 2435,2441 ****
      LIBS="$lt_cv_dlopen_libs $LIBS"
  
    echo $ac_n "checking whether a program can dlopen itself""... $ac_c" 1>&6
! echo "$progname:2433: checking whether a program can dlopen itself" >&5
  if test "${lt_cv_dlopen_self+set}" = set; then
    echo $ac_n "(cached) $ac_c" 1>&6
  else
--- 2523,2529 ----
      LIBS="$lt_cv_dlopen_libs $LIBS"
  
    echo $ac_n "checking whether a program can dlopen itself""... $ac_c" 1>&6
! echo "$progname:2526: checking whether a program can dlopen itself" >&5
  if test "${lt_cv_dlopen_self+set}" = set; then
    echo $ac_n "(cached) $ac_c" 1>&6
  else
***************
*** 2443,2449 ****
      lt_cv_dlopen_self=cross
    else
      cat > conftest.c <<EOF
! #line 2441 "ltconfig"
  
  #if HAVE_DLFCN_H
  #include <dlfcn.h>
--- 2531,2537 ----
      lt_cv_dlopen_self=cross
    else
      cat > conftest.c <<EOF
! #line 2534 "ltconfig"
  
  #if HAVE_DLFCN_H
  #include <dlfcn.h>
***************
*** 2489,2495 ****
  	       if(ptr1 || ptr2) { dlclose(self); exit(0); } } exit(1); } 
  
  EOF
! if { (eval echo $progname:2487: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
  then
    lt_cv_dlopen_self=yes
  else
--- 2577,2583 ----
  	       if(ptr1 || ptr2) { dlclose(self); exit(0); } } exit(1); } 
  
  EOF
! if { (eval echo $progname:2580: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
  then
    lt_cv_dlopen_self=yes
  else
***************
*** 2508,2514 ****
    if test "$lt_cv_dlopen_self" = yes; then
      LDFLAGS="$LDFLAGS $link_static_flag"
    echo $ac_n "checking whether a statically linked program can dlopen itself""... $ac_c" 1>&6
! echo "$progname:2506: checking whether a statically linked program can dlopen itself" >&5
  if test "${lt_cv_dlopen_self_static+set}" = set; then
    echo $ac_n "(cached) $ac_c" 1>&6
  else
--- 2596,2602 ----
    if test "$lt_cv_dlopen_self" = yes; then
      LDFLAGS="$LDFLAGS $link_static_flag"
    echo $ac_n "checking whether a statically linked program can dlopen itself""... $ac_c" 1>&6
! echo "$progname:2599: checking whether a statically linked program can dlopen itself" >&5
  if test "${lt_cv_dlopen_self_static+set}" = set; then
    echo $ac_n "(cached) $ac_c" 1>&6
  else
***************
*** 2516,2522 ****
      lt_cv_dlopen_self_static=cross
    else
      cat > conftest.c <<EOF
! #line 2514 "ltconfig"
  
  #if HAVE_DLFCN_H
  #include <dlfcn.h>
--- 2604,2610 ----
      lt_cv_dlopen_self_static=cross
    else
      cat > conftest.c <<EOF
! #line 2607 "ltconfig"
  
  #if HAVE_DLFCN_H
  #include <dlfcn.h>
***************
*** 2562,2568 ****
      if(ptr1 || ptr2) { dlclose(self); exit(0); } } exit(1); } 
  
  EOF
! if { (eval echo $progname:2560: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
  then
    lt_cv_dlopen_self_static=yes
  else
--- 2650,2656 ----
      if(ptr1 || ptr2) { dlclose(self); exit(0); } } exit(1); } 
  
  EOF
! if { (eval echo $progname:2653: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
  then
    lt_cv_dlopen_self_static=yes
  else
***************
*** 2654,2660 ****
  # NOTE: Changes made to this file will be lost: look at ltconfig or ltmain.sh.
  #
  # Copyright (C) 1996-1999 Free Software Foundation, Inc.
! # Gordon Matzigkeit <gord@gnu.ai.mit.edu>, 1996
  #
  # This program is free software; you can redistribute it and/or modify
  # it under the terms of the GNU General Public License as published by
--- 2742,2748 ----
  # NOTE: Changes made to this file will be lost: look at ltconfig or ltmain.sh.
  #
  # Copyright (C) 1996-1999 Free Software Foundation, Inc.
! # Originally by Gordon Matzigkeit <gord@gnu.ai.mit.edu>, 1996
  #
  # This program is free software; you can redistribute it and/or modify
  # it under the terms of the GNU General Public License as published by
***************
*** 2680,2686 ****
  
  # The HP-UX ksh and POSIX shell print the target directory to stdout
  # if CDPATH is set.
! if test "\${CDPATH+set}" = set; then CDPATH=; export CDPATH; fi
  
  ### BEGIN LIBTOOL CONFIG
  EOF
--- 2768,2774 ----
  
  # The HP-UX ksh and POSIX shell print the target directory to stdout
  # if CDPATH is set.
! if test "X\${CDPATH+set}" = Xset; then CDPATH=:; export CDPATH; fi
  
  ### BEGIN LIBTOOL CONFIG
  EOF
***************
*** 2725,2739 ****
  # Shell to use when invoking shell scripts.
  SHELL=$LTSHELL
  
- # Whether to waste disk space.
- install_ltlibs=$install_ltlibs 
- 
- # What to do with -release.
- #  yes - only for shared archive
- #  no  - ingnore
- #  all - for all archives
- release_suffix=$release_suffix
- 
  # Whether or not to build shared libraries.
  build_libtool_libs=$enable_shared
  
--- 2813,2818 ----
***************
*** 2952,2958 ****
  # AIX sometimes has problems with the GCC collect2 program.  For some
  # reason, if we set the COLLECT_NAMES environment variable, the problems
  # vanish in a puff of smoke.
! if test "${COLLECT_NAMES+set}" != set; then
    COLLECT_NAMES=
    export COLLECT_NAMES
  fi
--- 3031,3037 ----
  # AIX sometimes has problems with the GCC collect2 program.  For some
  # reason, if we set the COLLECT_NAMES environment variable, the problems
  # vanish in a puff of smoke.
! if test "X${COLLECT_NAMES+set}" != Xset; then
    COLLECT_NAMES=
    export COLLECT_NAMES
  fi
***************
*** 2962,2967 ****
--- 3041,3050 ----
  
    # Append the ltmain.sh script.
    sed '$q' "$ltmain" >> "$ofile" || (rm -f "$ofile"; exit 1)
+   # We use sed instead of cat because bash on DJGPP gets confused if
+   # if finds mixed CR/LF and LF-only lines.  Since sed operates in
+   # text mode, it properly converts lines to CR/LF.  This bash problem
+   # is reportedly fixed, but why not run on old versions too?
  
    chmod +x "$ofile"
    ;;


*** ltmain.sh	Sat Mar 11 19:37:36 2000
--- /usr/users/sysadmin/libtool-1.3.5/ltmain.sh	Sat May 27 07:15:01 2000
***************
*** 54,61 ****
  # Constants.
  PROGRAM=ltmain.sh
  PACKAGE=libtool
! VERSION=1.3.3-freebsd-ports
! TIMESTAMP=" (1.385.2.181 1999/07/02 15:49:11)"
  
  default_mode=
  help="Try \`$progname --help' for more information."
--- 54,61 ----
  # Constants.
  PROGRAM=ltmain.sh
  PACKAGE=libtool
! VERSION=1.3.5
! TIMESTAMP=" (1.385.2.206 2000/05/27 11:12:27)"
  
  default_mode=
  help="Try \`$progname --help' for more information."
***************
*** 435,441 ****
        fbsd_hideous_sh_bug=$base_compile
  
        # All platforms use -DPIC, to notify preprocessed assembler code.
!       command="$base_compile $pic_flag -DPIC $srcfile"
        if test "$build_old_libs" = yes; then
  	lo_libobj="$libobj"
  	dir=`$echo "X$libobj" | $Xsed -e 's%/[^/]*$%%'`
--- 435,441 ----
        fbsd_hideous_sh_bug=$base_compile
  
        # All platforms use -DPIC, to notify preprocessed assembler code.
!       command="$base_compile $srcfile $pic_flag -DPIC"
        if test "$build_old_libs" = yes; then
  	lo_libobj="$libobj"
  	dir=`$echo "X$libobj" | $Xsed -e 's%/[^/]*$%%'`
***************
*** 521,529 ****
  	  exit $error
  	fi
  
  	# Now arrange that obj and lo_libobj become the same file
! 	$show "$LN_S $obj $lo_libobj"
! 	if $run $LN_S $obj $lo_libobj; then
  	  exit 0
  	else
  	  error=$?
--- 521,537 ----
  	  exit $error
  	fi
  
+ 	xdir=`$echo "X$obj" | $Xsed -e 's%/[^/]*$%%'`
+ 	if test "X$xdir" = "X$obj"; then
+ 	  xdir="."
+ 	else
+ 	  xdir="$xdir"
+ 	fi
+ 	baseobj=`$echo "X$obj" | $Xsed -e "s%.*/%%"`
+ 	libobj=`$echo "X$baseobj" | $Xsed -e "$o2lo"`
  	# Now arrange that obj and lo_libobj become the same file
! 	$show "(cd $xdir && $LN_S $baseobj $libobj)"
! 	if $run eval '(cd $xdir && $LN_S $baseobj $libobj)'; then
  	  exit 0
  	else
  	  error=$?
***************
*** 613,620 ****
    # libtool link mode
    link)
      modename="$modename: link"
-     C_compiler="$CC" # save it, to compile generated C sources
-     CC="$nonopt"
      case "$host" in
      *-*-cygwin* | *-*-mingw* | *-*-os2*)
        # It is impossible to link a dll without this setting, and
--- 621,626 ----
***************
*** 802,809 ****
        allow_undefined=yes
        ;;
      esac
!     compile_command="$CC"
!     finalize_command="$CC"
  
      compile_rpath=
      finalize_rpath=
--- 808,815 ----
        allow_undefined=yes
        ;;
      esac
!     compile_command="$nonopt"
!     finalize_command="$nonopt"
  
      compile_rpath=
      finalize_rpath=
***************
*** 946,956 ****
  	  continue
  	  ;;
  	release)
! 	  if test "$release_suffix" = all; then
! 	    release="$arg"
! 	  elif test "$release_suffix" = yes; then
! 	    release="-$arg"
! 	  fi
  	  prev=
  	  continue
  	  ;;
--- 952,958 ----
  	  continue
  	  ;;
  	release)
! 	  release="-$arg"
  	  prev=
  	  continue
  	  ;;
***************
*** 1003,1009 ****
  	;;
  
        -avoid-version)
- 	build_old_libs=no
  	avoid_version=yes
  	continue
  	;;
--- 1005,1010 ----
***************
*** 1090,1099 ****
  	deplibs="$deplibs $arg"
  	;;
  
-       -?thread)
- 	deplibs="$deplibs $arg"
- 	;;
- 
        -module)
  	module=yes
  	continue
--- 1091,1096 ----
***************
*** 1171,1177 ****
  
        *.o | *.obj | *.a | *.lib)
  	# A standard object.
! 	libobjs="$libobjs $arg"
  	;;
  
        *.lo)
--- 1168,1174 ----
  
        *.o | *.obj | *.a | *.lib)
  	# A standard object.
! 	objs="$objs $arg"
  	;;
  
        *.lo)
***************
*** 1798,1805 ****
  	*-*-cygwin* | *-*-mingw* | *-*-os2* | *-*-beos*)
  	  # these systems don't actually have a c library (as such)!
  	  ;;
! 	*-*-freebsd*)
! 	  # FreeBSD doesn't need this...
  	  ;;
  	*)
  	  # Add libc to deplibs on all other systems.
--- 1795,1803 ----
  	*-*-cygwin* | *-*-mingw* | *-*-os2* | *-*-beos*)
  	  # these systems don't actually have a c library (as such)!
  	  ;;
!         *-*-rhapsody*)
! 	  # rhapsody is a little odd...
! 	  deplibs="$deplibs -framework System"
  	  ;;
  	*)
  	  # Add libc to deplibs on all other systems.
***************
*** 1808,1901 ****
  	esac
        fi
  
-       if test -n "$rpath$xrpath"; then
- 	# If the user specified any rpath flags, then add them.
- 	for libdir in $rpath $xrpath; do
- 	  # This is the magic to use -rpath.
- 	  case "$compile_rpath " in
- 	  *" $libdir "*) ;;
- 	  *) compile_rpath="$compile_rpath $libdir" ;;
- 	  esac
- 	  case "$finalize_rpath " in
- 	  *" $libdir "*) ;;
- 	  *) finalize_rpath="$finalize_rpath $libdir" ;;
- 	  esac
- 	done
-       fi
- 
-       # Now hardcode the library paths
-       rpath=
-       hardcode_libdirs=
-       for libdir in $compile_rpath; do
- 	if test -n "$hardcode_libdir_flag_spec"; then
- 	  if test -n "$hardcode_libdir_separator"; then
- 	    if test -z "$hardcode_libdirs"; then
- 	      hardcode_libdirs="$libdir"
- 	    else
- 	      # Just accumulate the unique libdirs.
- 	      case "$hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator" in
- 	      *"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"*)
- 		;;
- 	      *)
- 		hardcode_libdirs="$hardcode_libdirs$hardcode_libdir_separator$libdir"
- 		;;
- 	      esac
- 	    fi
- 	  else
- 	    eval flag=\"$hardcode_libdir_flag_spec\"
- 	    rpath="$rpath $flag"
- 	  fi
- 	elif test -n "$runpath_var"; then
- 	  case "$perm_rpath " in
- 	  *" $libdir "*) ;;
- 	  *) perm_rpath="$perm_rpath $libdir" ;;
- 	  esac
- 	fi
-       done
-       # Substitute the hardcoded libdirs into the rpath.
-       if test -n "$hardcode_libdir_separator" &&
- 	 test -n "$hardcode_libdirs"; then
- 	libdir="$hardcode_libdirs"
- 	eval rpath=\" $hardcode_libdir_flag_spec\"
-       fi
-       compile_rpath="$rpath"
- 
-       rpath=
-       hardcode_libdirs=
-       for libdir in $finalize_rpath; do
- 	if test -n "$hardcode_libdir_flag_spec"; then
- 	  if test -n "$hardcode_libdir_separator"; then
- 	    if test -z "$hardcode_libdirs"; then
- 	      hardcode_libdirs="$libdir"
- 	    else
- 	      # Just accumulate the unique libdirs.
- 	      case "$hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator" in
- 	      *"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"*)
- 		;;
- 	      *)
- 		hardcode_libdirs="$hardcode_libdirs$hardcode_libdir_separator$libdir"
- 		;;
- 	      esac
- 	    fi
- 	  else
- 	    eval flag=\"$hardcode_libdir_flag_spec\"
- 	    rpath="$rpath $flag"
- 	  fi
- 	elif test -n "$runpath_var"; then
- 	  case "$finalize_perm_rpath " in
- 	  *" $libdir "*) ;;
- 	  *) finalize_perm_rpath="$finalize_perm_rpath $libdir" ;;
- 	  esac
- 	fi
-       done
-       # Substitute the hardcoded libdirs into the rpath.
-       if test -n "$hardcode_libdir_separator" &&
- 	 test -n "$hardcode_libdirs"; then
- 	libdir="$hardcode_libdirs"
- 	eval rpath=\" $hardcode_libdir_flag_spec\"
-       fi
-       finalize_rpath="$rpath"
- 
        # Create the output directory, or remove our outputs if we need to.
        if test -d $output_objdir; then
  	$show "${rm}r $output_objdir/$outputname $output_objdir/$libname.* $output_objdir/${libname}${release}.*"
--- 1806,1811 ----
***************
*** 1911,1921 ****
  
        # Now set the variables for building old libraries.
        if test "$build_old_libs" = yes && test "$build_libtool_libs" != convenience ; then
! 	if test "$release_suffix" = all; then
! 	 oldlibs="$oldlibs $output_objdir/$libname$release.$libext"
! 	else
! 	 oldlibs="$oldlibs $output_objdir/$libname.$libext"
! 	fi
  
  	# Transform .lo files to .o files.
  	oldobjs="$objs "`$echo "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e "$lo2o" | $NL2SP`
--- 1821,1827 ----
  
        # Now set the variables for building old libraries.
        if test "$build_old_libs" = yes && test "$build_libtool_libs" != convenience ; then
! 	oldlibs="$oldlibs $output_objdir/$libname.$libext"
  
  	# Transform .lo files to .o files.
  	oldobjs="$objs "`$echo "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e "$lo2o" | $NL2SP`
***************
*** 1955,1961 ****
  	  int main() { return 0; }
  EOF
  	  $rm conftest
! 	  $C_compiler -o conftest conftest.c $deplibs
  	  if test $? -eq 0 ; then
  	    ldd_output=`ldd conftest`
  	    for i in $deplibs; do
--- 1861,1867 ----
  	  int main() { return 0; }
  EOF
  	  $rm conftest
! 	  $CC -o conftest conftest.c $deplibs
  	  if test $? -eq 0 ; then
  	    ldd_output=`ldd conftest`
  	    for i in $deplibs; do
***************
*** 1988,1994 ****
  	     # If $name is empty we are operating on a -L argument.
  	      if test "$name" != "" ; then
  		$rm conftest
! 		$C_compiler -o conftest conftest.c $i
  		# Did it work?
  		if test $? -eq 0 ; then
  		  ldd_output=`ldd conftest`
--- 1894,1900 ----
  	     # If $name is empty we are operating on a -L argument.
  	      if test "$name" != "" ; then
  		$rm conftest
! 		$CC -o conftest conftest.c $i
  		# Did it work?
  		if test $? -eq 0 ; then
  		  ldd_output=`ldd conftest`
***************
*** 2109,2119 ****
  	      echo "*** \`nm' from GNU binutils and a full rebuild may help."
  	    fi
  	    if test "$build_old_libs" = no; then
! 	      if test "$release_suffix" = all; then
! 	        oldlibs="$output_objdir/$libname$release.$libext"
! 	      else
! 	        oldlibs="$output_objdir/$libname.$libext"
! 	      fi
  	      build_libtool_libs=module
  	      build_old_libs=yes
  	    else
--- 2015,2021 ----
  	      echo "*** \`nm' from GNU binutils and a full rebuild may help."
  	    fi
  	    if test "$build_old_libs" = no; then
! 	      oldlibs="$output_objdir/$libname.$libext"
  	      build_libtool_libs=module
  	      build_old_libs=yes
  	    else
***************
*** 2155,2167 ****
  	done
  
  	# Ensure that we have .o objects for linkers which dislike .lo
! 	# (e.g. aix) incase we are running --disable-static
  	for obj in $libobjs; do
! 	  oldobj=`$echo "X$obj" | $Xsed -e "$lo2o"`
! 	  if test ! -f $oldobj; then
! 	    $show "${LN_S} $obj $oldobj"
! 	    $run ${LN_S} $obj $oldobj || exit $?
  	  fi
  	done
  
  	# Use standard objects if they are pic
--- 2057,2076 ----
  	done
  
  	# Ensure that we have .o objects for linkers which dislike .lo
! 	# (e.g. aix) in case we are running --disable-static
  	for obj in $libobjs; do
! 	  xdir=`$echo "X$obj" | $Xsed -e 's%/[^/]*$%%'`
! 	  if test "X$xdir" = "X$obj"; then
! 	    xdir="."
! 	  else
! 	    xdir="$xdir"
  	  fi
+ 	  baseobj=`$echo "X$obj" | $Xsed -e 's%^.*/%%'`
+ 	  oldobj=`$echo "X$baseobj" | $Xsed -e "$lo2o"`
+ 	  if test ! -f $xdir/$oldobj; then
+ 	    $show "(cd $xdir && ${LN_S} $baseobj $oldobj)"
+ 	    $run eval '(cd $xdir && ${LN_S} $baseobj $oldobj)' || exit $?
+ 	  fi
  	done
  
  	# Use standard objects if they are pic
***************
*** 2419,2426 ****
  	# Just create a symlink.
  	$show $rm $libobj
  	$run $rm $libobj
! 	$show "$LN_S $obj $libobj"
! 	$run $LN_S $obj $libobj || exit $?
        fi
  
        if test -n "$gentop"; then
--- 2328,2343 ----
  	# Just create a symlink.
  	$show $rm $libobj
  	$run $rm $libobj
! 	xdir=`$echo "X$libobj" | $Xsed -e 's%/[^/]*$%%'`
! 	if test "X$xdir" = "X$libobj"; then
! 	  xdir="."
! 	else
! 	  xdir="$xdir"
! 	fi
! 	baseobj=`$echo "X$libobj" | $Xsed -e 's%^.*/%%'`
! 	oldobj=`$echo "X$baseobj" | $Xsed -e "$lo2o"`
! 	$show "(cd $xdir && $LN_S $oldobj $baseobj)"
! 	$run eval '(cd $xdir && $LN_S $oldobj $baseobj)' || exit $?
        fi
  
        if test -n "$gentop"; then
***************
*** 2706,2721 ****
  	  # linked before any other PIC object.  But we must not use
  	  # pic_flag when linking with -static.  The problem exists in
  	  # FreeBSD 2.2.6 and is fixed in FreeBSD 3.1.
! 	  *-*-freebsd2*|*-*-freebsd3.0*)
  	    case "$compile_command " in
  	    *" -static "*) ;;
  	    *) pic_flag_for_symtable=" $pic_flag -DPIC -DFREEBSD_WORKAROUND";;
  	    esac
  	  esac
  
  	  # Now compile the dynamic symbol file.
! 	  $show "(cd $output_objdir && $C_compiler -c$no_builtin_flag$pic_flag_for_symtable \"$dlsyms\")"
! 	  $run eval '(cd $output_objdir && $C_compiler -c$no_builtin_flag$pic_flag_for_symtable "$dlsyms")' || exit $?
  
  	  # Clean up the generated files.
  	  $show "$rm $output_objdir/$dlsyms $nlist ${nlist}S ${nlist}T"
--- 2623,2643 ----
  	  # linked before any other PIC object.  But we must not use
  	  # pic_flag when linking with -static.  The problem exists in
  	  # FreeBSD 2.2.6 and is fixed in FreeBSD 3.1.
! 	  *-*-freebsd2*|*-*-freebsd3.0*|*-*-freebsdelf3.0*)
  	    case "$compile_command " in
  	    *" -static "*) ;;
  	    *) pic_flag_for_symtable=" $pic_flag -DPIC -DFREEBSD_WORKAROUND";;
+ 	    esac;;
+ 	  *-*-hpux*)
+ 	    case "$compile_command " in
+ 	    *" -static "*) ;;
+ 	    *) pic_flag_for_symtable=" $pic_flag -DPIC";;
  	    esac
  	  esac
  
  	  # Now compile the dynamic symbol file.
! 	  $show "(cd $output_objdir && $CC -c$no_builtin_flag$pic_flag_for_symtable \"$dlsyms\")"
! 	  $run eval '(cd $output_objdir && $CC -c$no_builtin_flag$pic_flag_for_symtable "$dlsyms")' || exit $?
  
  	  # Clean up the generated files.
  	  $show "$rm $output_objdir/$dlsyms $nlist ${nlist}S ${nlist}T"
***************
*** 2884,2890 ****
  
  # The HP-UX ksh and POSIX shell print the target directory to stdout
  # if CDPATH is set.
! if test \"\${CDPATH+set}\" = set; then CDPATH=; export CDPATH; fi
  
  relink_command=\"$relink_command\"
  
--- 2806,2812 ----
  
  # The HP-UX ksh and POSIX shell print the target directory to stdout
  # if CDPATH is set.
! if test \"\${CDPATH+set}\" = set; then CDPATH=:; export CDPATH; fi
  
  relink_command=\"$relink_command\"
  
***************
*** 2973,2979 ****
    fi"
  	else
  	  echo >> $output "\
!   program='$outputname$exeext'
    progdir=\"\$thisdir/$objdir\"
  "
  	fi
--- 2895,2901 ----
    fi"
  	else
  	  echo >> $output "\
!   program='$outputname'
    progdir=\"\$thisdir/$objdir\"
  "
  	fi
***************
*** 3009,3021 ****
        # Run the actual program with our arguments.
  "
  	case $host in
- 	*-*-cygwin* | *-*-mingw | *-*-os2*)
  	  # win32 systems need to use the prog path for dll
  	  # lookup to work
  	  $echo >> $output "\
        exec \$progdir\\\\\$program \${1+\"\$@\"}
  "
  	  ;;
  	*)
  	  $echo >> $output "\
        # Export the path to the program.
--- 2931,2951 ----
        # Run the actual program with our arguments.
  "
  	case $host in
  	  # win32 systems need to use the prog path for dll
  	  # lookup to work
+ 	*-*-cygwin*)
  	  $echo >> $output "\
+       exec \$progdir/\$program \${1+\"\$@\"}
+ "
+ 	  ;;
+ 
+ 	# Backslashes separate directories on plain windows
+ 	*-*-mingw | *-*-os2*)
+ 	  $echo >> $output "\
        exec \$progdir\\\\\$program \${1+\"\$@\"}
  "
  	  ;;
+ 
  	*)
  	  $echo >> $output "\
        # Export the path to the program.
***************
*** 3103,3116 ****
        if test -n "$old_archive_from_new_cmds" && test "$build_libtool_libs" = yes; then
  	eval cmds=\"$old_archive_from_new_cmds\"
        else
! 	# Ensure that we have .o objects in place incase we decided
  	# not to build a shared library, and have fallen back to building
  	# static libs even though --disable-static was passed!
  	for oldobj in $oldobjs; do
  	  if test ! -f $oldobj; then
! 	    obj=`$echo "X$oldobj" | $Xsed -e "$o2lo"`
! 	    $show "${LN_S} $obj $oldobj"
! 	    $run ${LN_S} $obj $oldobj || exit $?
  	  fi
  	done
  
--- 3033,3053 ----
        if test -n "$old_archive_from_new_cmds" && test "$build_libtool_libs" = yes; then
  	eval cmds=\"$old_archive_from_new_cmds\"
        else
! 	# Ensure that we have .o objects in place in case we decided
  	# not to build a shared library, and have fallen back to building
  	# static libs even though --disable-static was passed!
  	for oldobj in $oldobjs; do
  	  if test ! -f $oldobj; then
! 	    xdir=`$echo "X$oldobj" | $Xsed -e 's%/[^/]*$%%'`
! 	    if test "X$xdir" = "X$oldobj"; then
! 	      xdir="."
! 	    else
! 	      xdir="$xdir"
! 	    fi
! 	    baseobj=`$echo "X$oldobj" | $Xsed -e 's%^.*/%%'`
! 	    obj=`$echo "X$baseobj" | $Xsed -e "$o2lo"`
! 	    $show "(cd $xdir && ${LN_S} $obj $baseobj)"
! 	    $run eval '(cd $xdir && ${LN_S} $obj $baseobj)' || exit $?
  	  fi
  	done
  
***************
*** 3134,3144 ****
      case "$output" in
      *.la)
        old_library=
!       if test "$release_suffix" = all; then
!         test "$build_old_libs" = yes && old_library="$libname$release.$libext"
!       else
!         test "$build_old_libs" = yes && old_library="$libname.$libext"
!       fi
        $show "creating $output"
  
        if test -n "$xrpath"; then
--- 3071,3077 ----
      case "$output" in
      *.la)
        old_library=
!       test "$build_old_libs" = yes && old_library="$libname.$libext"
        $show "creating $output"
  
        if test -n "$xrpath"; then
***************
*** 3427,3438 ****
  	fi
  
  	# Install the pseudo-library for information purposes.
! 	if test "$install_ltlibs" = yes; then
! 	  name=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
! 	  instname="$dir/$name"i
! 	  $show "$install_prog $instname $destdir/$name"
! 	  $run eval "$install_prog $instname $destdir/$name" || exit $?
! 	fi
  
  	# Maybe install the static library, too.
  	test -n "$old_library" && staticlibs="$staticlibs $dir/$old_library"
--- 3360,3369 ----
  	fi
  
  	# Install the pseudo-library for information purposes.
! 	name=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
! 	instname="$dir/$name"i
! 	$show "$install_prog $instname $destdir/$name"
! 	$run eval "$install_prog $instname $destdir/$name" || exit $?
  
  	# Maybe install the static library, too.
  	test -n "$old_library" && staticlibs="$staticlibs $dir/$old_library"
***************
*** 3521,3526 ****
--- 3452,3458 ----
  	    fi
  	    libfile="$libdir/`$echo "X$lib" | $Xsed -e 's%^.*/%%g'`"
  	    if test -n "$libdir" && test ! -f "$libfile"; then
+ 	      $echo "$modename: warning: \`$lib' has not been installed in \`$libdir'" 1>&2
  	      finalize=no
  	    fi
  	  done
***************
*** 3785,3792 ****
      done
  
      if test -z "$run"; then
!       # Export the shlibpath_var.
!       eval "export $shlibpath_var"
  
        # Restore saved enviroment variables
        if test "${save_LC_ALL+set}" = set; then
--- 3717,3726 ----
      done
  
      if test -z "$run"; then
!       if test -n "$shlibpath_var"; then
!         # Export the shlibpath_var.
!         eval "export $shlibpath_var"
!       fi
  
        # Restore saved enviroment variables
        if test "${save_LC_ALL+set}" = set; then
***************
*** 3803,3810 ****
        exit 1
      else
        # Display what would be done.
!       eval "\$echo \"\$shlibpath_var=\$$shlibpath_var\""
!       $echo "export $shlibpath_var"
        $echo "$cmd$args"
        exit 0
      fi
--- 3737,3746 ----
        exit 1
      else
        # Display what would be done.
!       if test -n "$shlibpath_var"; then
!         eval "\$echo \"\$shlibpath_var=\$$shlibpath_var\""
!         $echo "export $shlibpath_var"
!       fi
        $echo "$cmd$args"
        exit 0
      fi


>How-To-Repeat:
n/a
>Fix:
n/a
>Release-Note:
>Audit-Trail:
State-Changed-From-To: open-suspended
State-Changed-By: rbb
State-Changed-When: Tue Oct 17 16:39:19 PDT 2000
State-Changed-Why:
This is an infrastructure issue that we are looking into.

The problem is that whoever rolls the Apache 2.0 tarball
will need an updated libtool on their system.  There is a
relatively easy workaround however.  We provide libtool as
a convenience in our alpha builds.  If you configure the
server once and run "make distclean", then run ./buildconf
it will recreate all of the libtool files as symbolic links
to libtool from your machine.
State-Changed-From-To: suspended-closed
State-Changed-By: rbb
State-Changed-When: Mon Nov  6 17:22:20 PST 2000
State-Changed-Why:
The libtool on the machine used to build the alpha's has
been updated to version 1.3.4.  We will try to continue
to update libtool on this machine as newer releases are made.
However, the long-term fix for this, is for the developer to
run "make distclean;./buildconf" in the src directory.  This
will use the autoconf and libtool that are installed on the
developers machine.
>Unformatted:
 [In order for any reply to be added to the PR database, you need]
 [to include <apbugs@Apache.Org> in the Cc line and make sure the]
 [subject line starts with the report component and number, with ]
 [or without any 'Re:' prefixes (such as "general/1098:" or      ]
 ["Re: general/1098:").  If the subject doesn't match this       ]
 [pattern, your message will be misfiled and ignored.  The       ]
 ["apbugs" address is not added to the Cc line of messages from  ]
 [the database automatically because of the potential for mail   ]
 [loops.  If you do not include this Cc, your reply may be ig-   ]
 [nored unless you are responding to an explicit request from a  ]
 [developer.  Reply only with text; DO NOT SEND ATTACHMENTS!     ]
 
 

