From nobody@hyperreal.com  Wed Jun 11 18:38:41 1997
Received: (from nobody@localhost)
	by hyperreal.com (8.8.5/8.8.5) id SAA26326;
	Wed, 11 Jun 1997 18:38:41 -0700 (PDT)
Message-Id: <199706120138.SAA26326@hyperreal.com>
Date: Wed, 11 Jun 1997 18:38:41 -0700 (PDT)
From: jeff hayes <jhayes@aw.sgi.com>
Reply-To: jhayes@aw.sgi.com
To: apbugs@hyperreal.com
Subject: Makefile for src/modules fails if no contrib modules are defined.
X-Send-Pr-Version: 3.2

>Number:         723
>Category:       config
>Synopsis:       Makefile for src/modules fails if no contrib modules are defined.
>Confidential:   no
>Severity:       non-critical
>Priority:       medium
>Responsible:    apache
>State:          closed
>Class:          sw-bug
>Submitter-Id:   apache
>Arrival-Date:   Wed Jun 11 18:40:00 1997
>Last-Modified:  Sun Jul 20 22:57:38 PDT 1997
>Originator:     jhayes@aw.sgi.com
>Organization:
>Release:        1.2
>Environment:
uname -a
IRIX namehere 6.3 12161207 IP32  - an R5K O2
building Apache 1.2 golden
>Description:
The Makefile built by Configure in src/modules when no contrib modules are
specifed in the Configuration file fails with errors during "make clean".
For some reason it works fine in the compile phase.

I supply a diff of the changes I made - note that these changes are on
top of the ones that I added to enable n32 bit compilation on irix 6.*
machines.
>How-To-Repeat:

>Fix:
lets hope this fits:
diff -c src1.2std/Configure  src/Configure
*** src1.2std/Configure Tue Jun 10 15:34:22 1997
--- src/Configure       Wed Jun 11 20:48:07 1997
***************
*** 102,108 ****
     }'
  
  #
! # Add module set only
  #
  echo "#" > Makefile
  echo "# Makefile automatically generated from $makefile_tmpl" >> Makefile
--- 102,109 ----
     }'
  
  #
! # Building the src/ dir Makefile
! # Start with the module set 
  #
  echo "#" > Makefile
  echo "# Makefile automatically generated from $makefile_tmpl" >> Makefile
***************
*** 153,161 ****
  # As more PLATFORMs are added to Configuration.tmpl, be sure to
  # add the required lines below.
  #
! set echo;set verbose
  PLAT=`./helpers/GuessOS`
! unset echo verbose
  # Preset DBM_LIB. Can be overridden on a per-platform basis.
  
  DBM_LIB="-ldbm"
--- 154,162 ----
  # As more PLATFORMs are added to Configuration.tmpl, be sure to
  # add the required lines below.
  #
! 
  PLAT=`./helpers/GuessOS`
! 
  # Preset DBM_LIB. Can be overridden on a per-platform basis.
  
  DBM_LIB="-ldbm"
***************
*** 605,612 ****
--- 606,641 ----
  sed -e "s#@@Configuration@@#$file#" "$makefile_tmpl" >>Makefile
  awk >>Makefile <$tmpfile \
     '($1 == "Module" && $3 ~ /modules\//) { printf "%s: modules/last-built ; @cat /dev/null\n\n", $3, $3}'
+ 
+ #
+ # now we assemble the ../support/ dir Makefile
+ #
+ echo " + building Makefile for ../support"
  cat Makefile.config ../support/Makefile.tmpl > ../support/Makefile
  
+ #
+ # now we assemble the src/modules  Makefile
+ #
+ echo " + building Makefile for src/modules"
+ 
+ nullmodlist=`awk < $tmpfile \
+       '($1 == "Module" && $3 ~ /modules\//){ printf "$3"}'`
+ 
+ # it may be that no contrib modules are to be built ...
+ #
+ if [ "x$nullmodlist" = "x" ]; then
+ cat << EOF > modules/Makefile
+ # Null Makefile for src/modules
+ # Generated by src/Configure according to rules in src/Configuration;
+ # hand-edit at your own risk!
+ default:
+       @echo "no modules here to build"
+ clean:
+       @echo "no modules here to clean"
+ 
+ EOF
+ 
+ else
  cat << EOF > modules/Makefile
  # 
  # Simple Makefile for modules in src/modules.
***************
*** 653,655 ****
--- 682,685 ----
     '($1 == "Module" && $3 ~ /modules\//) { split ($3, pp, "/"); \
     printf "%s_clean:\n\t(cd %s; $(MAKE) clean)\n\n", pp[2], pp[2]}'
  
+ fi

%0
>Audit-Trail:
State-Changed-From-To: open-closed
State-Changed-By: marc
State-Changed-When: Sun Jul 20 22:57:38 PDT 1997
State-Changed-Why:
This should be fixed in 1.2.1 in a different way.  Please
let us know if the problem is still there.
>Unformatted:


