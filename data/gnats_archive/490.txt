From nobody@hyperreal.com  Sun Apr 27 16:44:53 1997
Received: (from nobody@localhost)
	by hyperreal.com (8.8.5/8.8.5) id QAA10062;
	Sun, 27 Apr 1997 16:44:53 -0700 (PDT)
Message-Id: <199704272344.QAA10062@hyperreal.com>
Date: Sun, 27 Apr 1997 16:44:53 -0700 (PDT)
From: Kenneth Smith <kenneth@jump.net>
Reply-To: kenneth@jump.net
To: apbugs@hyperreal.com
Subject: httpd dumps core
X-Send-Pr-Version: 3.2

>Number:         490
>Category:       mod_cgi
>Synopsis:       httpd dumps core
>Confidential:   no
>Severity:       critical
>Priority:       medium
>Responsible:    apache
>State:          closed
>Class:          sw-bug
>Submitter-Id:   apache
>Arrival-Date:   Sun Apr 27 16:50:01 1997
>Last-Modified:  Sat Jun 28 15:42:09 PDT 1997
>Originator:     kenneth@jump.net
>Organization:
>Release:        1.2b7 and 1.2b9
>Environment:
Sun Solaris 2.5.1, Sun's recommended patches as of a few days ago.
GCC 2.7.2.2
>Description:
121 virtual hosts works. 122 virtual hosts causes httpd to core
dump when user does CGI.  Any 121 virtual hosts works, adding
one more at any spot in httpd.conf causes the core dump.

The GDB stack trace is from 1.2b9.  mod_cgi.c:532 seems to be
the offending code, but, it looks ok.

Core was generated by `/usr/local/bin/httpd'.
Program terminated with signal 6, Aborted.
Reading symbols from /usr/lib/libsocket.so.1...done.
Reading symbols from /usr/lib/libnsl.so.1...done.
Reading symbols from /usr/lib/libc.so.1...done.
Reading symbols from /usr/lib/libdl.so.1...done.
Reading symbols from /usr/lib/libintl.so.1...done.
Reading symbols from /usr/lib/libmp.so.1...done.
Reading symbols from /usr/lib/libw.so.1...done.
Reading symbols from /usr/lib/nss_dns.so.1...done.
Reading symbols from /usr/lib/libresolv.so.2...done.
Reading symbols from /usr/lib/nss_files.so.1...done.
#0  0#0  0xef63452c in kill ()
#1  0xef5fa620 in abort ()
#2  0x1b8e8 in seg_fault () at http_main.c:1261
#3  <signal handler called>
#4  0xef62e910 in fread ()
#5  0x506e0 in cgi_handler (r=0xd7ff8) at mod_cgi.c:532
#6  0x22704 in invoke_handler (r=0xd7ff8) at http_config.c:333
#7  0x27848 in process_request_internal (r=0xd7ff8) at http_request.c:969
#8  0x2789c in process_request (r=0xd7ff8) at http_request.c:983
#9  0x1cd04 in child_main (child_num_arg=0) at http_main.c:1862
#10 0x1cf9c in make_child (server_conf=0x82f90, child_num=0)
    at http_main.c:1956
#11 0x1db8c in standalone_main (argc=1, argv=0xeffffe0c) at http_main.c:2266
#12 0x1e144 in main (argc=1, argv=0xeffffe0c) at http_main.c:2393
(gdb)
xef63452c in kill ()
(gdb) bt
>How-To-Repeat:

>Fix:

>Audit-Trail:
State-Changed-From-To: open-analyzed
State-Changed-By: marc
State-Changed-When: Sun Apr 27 16:59:03 PDT 1997
State-Changed-Why:
Probably related to running out of file descriptors.  Comments
sent in mail.

From: Marc Slemko <marcs@znep.com>
To: Kenneth Smith <kenneth@jump.net>
Subject: Re: mod_cgi/490: httpd dumps core
Date: Sun, 27 Apr 1997 17:55:48 -0600 (MDT)

 
 On Sun, 27 Apr 1997, Kenneth Smith wrote:
 
 > >Release:        1.2b7 and 1.2b9
 
 1.2b9 is broken for CGIs called in the form foo.cgi?bar and has been
 pulled until this is fixed.
 
 > >Environment:
 > Sun Solaris 2.5.1, Sun's recommended patches as of a few days ago.
 > GCC 2.7.2.2
 > >Description:
 > 121 virtual hosts works. 122 virtual hosts causes httpd to core
 > dump when user does CGI.  Any 121 virtual hosts works, adding
 > one more at any spot in httpd.conf causes the core dump.
 
 You are probably running out of file descriptors.  Various system
 functions can get quite cranky.  See
 
 	http://www.apache.org/docs/misc/FAQ.html#fdlim
 
 for details.
 

From: kenneth@jump.net (Kenneth A. Smith)
To: marcs@znep.com (Marc Slemko)
Subject: Re: mod_cgi/490: httpd dumps core
Date: Sun, 27 Apr 1997 19:42:51 -0500 (CDT)

 
 
 
 Tried bumping up from 512 file descriptors to 1024 and 1.2b7 httpd
 still dumps core.
 
 
 Kenneth
 
 
 > 
 > On Sun, 27 Apr 1997, Kenneth Smith wrote:
 > 
 > > >Release:        1.2b7 and 1.2b9
 > 
 > 1.2b9 is broken for CGIs called in the form foo.cgi?bar and has been
 > pulled until this is fixed.
 > 
 > > >Environment:
 > > Sun Solaris 2.5.1, Sun's recommended patches as of a few days ago.
 > > GCC 2.7.2.2
 > > >Description:
 > > 121 virtual hosts works. 122 virtual hosts causes httpd to core
 > > dump when user does CGI.  Any 121 virtual hosts works, adding
 > > one more at any spot in httpd.conf causes the core dump.
 > 
 > You are probably running out of file descriptors.  Various system
 > functions can get quite cranky.  See
 > 
 > 	http://www.apache.org/docs/misc/FAQ.html#fdlim
 > 
 > for details.
 > 
 

From: Marc Slemko <marcs@znep.com>
To: "Kenneth A. Smith" <kenneth@jump.net>
Subject: Re: mod_cgi/490: httpd dumps core
Date: Sun, 27 Apr 1997 18:55:37 -0600 (MDT)

 
 On Sun, 27 Apr 1997, Kenneth A. Smith wrote:
 
 > 
 > 
 > Tried bumping up from 512 file descriptors to 1024 and 1.2b7 httpd
 > still dumps core.
 
 This is probably due to problems with Solaris versions before 2.6 not
 handling FILE structures with a fd > 255.  There are possible other issues
 in Solaris with fds > 255 as well.
 
 If you can verify that adding the virtual hosts works if you don't have a
 separate logfile for them, then this is a Solaris problem. 
 
 
State-Changed-From-To: analyzed-closed
State-Changed-By: dgaudet
State-Changed-When: Sat Jun 28 15:42:09 PDT 1997
State-Changed-Why:
A workaround and documentation has been committed to 1.2.1-dev
and 1.3-dev.

Thanks
Dean
>Unformatted:





