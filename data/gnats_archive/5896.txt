Received: (qmail 92104 invoked by uid 65534); 17 Mar 2000 16:08:45 -0000
Message-Id: <20000317160845.92103.qmail@locus.apache.org>
Date: 17 Mar 2000 16:08:45 -0000
From: Andreas Achtzehn <achtzehn@linux-society.de>
Reply-To: achtzehn@linux-society.de
To: submit@bugz.apache.org
Subject: multipart-messages and squid-proxy-server
X-Send-Pr-Version: 3.110

>Number:         5896
>Category:       config
>Synopsis:       multipart-messages and squid-proxy-server
>Confidential:   no
>Severity:       serious
>Priority:       medium
>Responsible:    apache
>State:          open
>Class:          sw-bug
>Submitter-Id:   apache
>Arrival-Date:   Fri Mar 17 08:10:00 PST 2000
>Closed-Date:    
>Last-Modified:  Fri Mar 17 08:40:01 PST 2000
>Originator:     achtzehn@linux-society.de
>Release:        1.3.9
>Organization:
apache
>Environment:
SuSE Linux 6.3
>Description:
If apache sends a multipart-content (multipart/x-mixed-replace) in an endless loop generated by a cgi-script it doesn't stop sending it even if the user hits "stop" in his browser. This problem doesn't occure if the user has a direct connection to the web-server. It only occurs when a squid-server is used for connection. 
Unfortunately the stream is sent to the proxy-server as fast as possible and if both servers are sharing one subnet (or are connected by a very fast line) it causes the proxy-server to lockup. 
>How-To-Repeat:
This is the script I used:
#!/usr/bin/perl
print "Content-Type: multipart/x-mixed-replace;boundary=myboundary\n\n";
print "--myboundary";
while (true) {
      print "\nContent-Type: image/gif\n\n";
      open(PIC,"webcamimage.gif") || die "Could not open file : $!\n";
      while (<PIC>) {
        print $_;
      }
      close(PIC);
      print "\n--myboundary";
   }
}
print "--\n";
>Fix:
Apache has to recognize the squid-proxy and validate that the user is still "wanting" that file. If not, it has to terminate the script.
>Release-Note:
>Audit-Trail:

From: Marc Slemko <marcs@znep.com>
To: achtzehn@linux-society.de
Cc: Apache bugs database <apbugs@apache.org>
Subject: Re: config/5896: multipart-messages and squid-proxy-server
Date: Fri, 17 Mar 2000 09:12:13 -0700 (MST)

 On 17 Mar 2000, Andreas Achtzehn wrote:
 
 > Apache has to recognize the squid-proxy and validate that the user is
 > still "wanting" that file. If not, it has to terminate the script.
 
 Erm... there is no way Apache should recognize there is a squid proxy out
 there.  Apache already does everything it can; if the squid proxy keeps
 accepting, then Apache has no way to know to stop sending.  
 
 You may want to look at your squid configs to tell if it should keep
 accepting content after the user that requested it disconnected.
 

From: Marc Slemko <marcs@znep.com>
To: Andreas Achtzehn <achtzehn@linux-society.de>
Cc: Apache bugs database <apbugs@apache.org>
Subject: Re: config/5896: multipart-messages and squid-proxy-server
Date: Fri, 17 Mar 2000 09:34:44 -0700 (MST)

 On Fri, 17 Mar 2000, Andreas Achtzehn wrote:
 
 > > On 17 Mar 2000, Andreas Achtzehn wrote:
 > >
 > > > Apache has to recognize the squid-proxy and validate that
 > > the user is
 > > > still "wanting" that file. If not, it has to terminate the script.
 > >
 > > Erm... there is no way Apache should recognize there is a
 > > squid proxy out
 > > there.  Apache already does everything it can; if the squid
 > > proxy keeps
 > > accepting, then Apache has no way to know to stop sending.
 > >
 > > You may want to look at your squid configs to tell if it should keep
 > > accepting content after the user that requested it disconnected.
 > 
 > My problem is that I'd like to run a webcam over user Netscape Server
 > Push. It will probably be a problem to patch any squid-server that will
 > connect to my server. Isn't there any signal for apache to interpret to
 > kill the script. It works for Netscape-Direct, why not for squid?
 
 As I have already said, it isn't what Apache does that is the problem.
 
 I have no idea what "Netscape-Direct" is, but I'm assuming it is some sort
 of proxy.  If it works for some other proxy but not for squid, why would
 it be an Apache problem?  There is nothing Apache can do.  It doesn't get
 any magic communications from the proxy.  If the proxy keeps accepting,
 Apache has no choice but to keep sending.  That's just the way things
 work.  We really can't help you.
 
>Unformatted:
 [In order for any reply to be added to the PR database, you need]
 [to include <apbugs@Apache.Org> in the Cc line and make sure the]
 [subject line starts with the report component and number, with ]
 [or without any 'Re:' prefixes (such as "general/1098:" or      ]
 ["Re: general/1098:").  If the subject doesn't match this       ]
 [pattern, your message will be misfiled and ignored.  The       ]
 ["apbugs" address is not added to the Cc line of messages from  ]
 [the database automatically because of the potential for mail   ]
 [loops.  If you do not include this Cc, your reply may be ig-   ]
 [nored unless you are responding to an explicit request from a  ]
 [developer.  Reply only with text; DO NOT SEND ATTACHMENTS!     ]
 
 

